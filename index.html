<!doctype html>
<html>
<head>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
  <link rel="stylesheet" href="css/places.css">
  <!--[if lte IE 8]>
     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
  <![endif]-->
  <style type="text/css">
    body {
      padding: 0;
      margin: 0;
    }

    html, body, #PlacesYouCantGo {
      height: 100%;
      width: 90%;
    }

  </style>
  <script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>
  <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<body>
  <div id="PlacesYouCantGo"></div>

  <div class="sidepanel">
      <div class="wrapper">
        <div class="context subheader">
          <p>map created by <a href="https://twitter.com/mappingCo">Mapping & Co</a></p>
        </div>
        <h1 id="headline"><i>"Top 10 Places You Can't Go"</i></h1>
        <div id="info">
            <p>
                Animated map made with the "Top 10 Places You Cant Go" list by JAMIE FRATER in 2010
            </p>
            <p class='source'>
                - <a href="http://listverse.com/2010/01/06/top-10-places-you-cant-go/" target="_blank">listverse.com</a>
            </p>
        </div>
        <div class="context footer">
        </div>
      </div>
      <div id="go-button" >
        <a id="go">go</a></p>
      </div>
      <div id="back-button" class="hidden">
        <a id="back">back</a></p>
      </div>
      <div id="next-button" class="hidden">
        <a id="next">next</a></p>
      </div>
    </div>


  <script>
    var map,
      mapView = 0,
      mapViewZoom,
      mapCenterLon,
      mapCenterLat,
      headline_h1,
      info_p,
      top_p;
    
    var numFeatures = 10;

    $('#go').click(function(){
      $('#back-button').removeClass('hidden');
      $('#next-button').removeClass('hidden');
      $('#go-button').addClass('hidden');
      changeCenter(mapView);
      console.log('change to mapView '+ mapView)
    });

    $('#next').click(function(){
      if (mapView < numFeatures) {
        mapView= mapView+1;
      }
      else {
        mapView=0;
      }
      changeCenter(mapView);
      console.log('change to mapView '+ mapView)
    });

    $('#back').click(function(){
      if (mapView>0) {
        mapView= mapView-1;
      }
      else {
        mapView= numFeatures;
      }
      changeCenter(mapView);
      console.log('change to mapView '+ mapView)
    });

    

    //base map
    var places = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    });

    //get geojson data on the map
    $.getJSON("./GeoJSON/places.geojson", function(data) {
      var geojson = L.geoJson(data, {
        onEachFeature: function (feature, layer) {
          layer.bindPopup('<b>'+feature.properties.name + '</b><br />' + feature.properties.lat+', '+ feature.properties.lon);
        }
      });
      map = L.map('PlacesYouCantGo').fitBounds(geojson.getBounds());
      places.addTo(map);
      geojson.addTo(map);
      map.setView(new L.LatLng(40.7, 30.25), 2);
    });
    //zoom a la siguiente localizacion 
    function changeCenter(mapView){
      $.ajax({
        url: './GeoJSON/places.geojson',
        async: false,
        dataType: 'json',
        success: function (data) {
          console.log(data.features[mapView].properties.name);
          mapCenterLat = data.features[mapView].geometry.coordinates[1];
          mapCenterLon = data.features[mapView].geometry.coordinates[0];
          headline_h1 = data.features[mapView].properties.name;
          info_p = data.features[mapView].properties.text;
          top_p = data.features[mapView].properties.top;
          mapViewZoom= data.features[mapView].properties.zoom;

        }

      });
      console.log('new mapCenter: '+ mapCenterLat +','+mapCenterLon)

      var targetlatlng = L.latLng(mapCenterLat, mapCenterLon);
      map.setView(targetlatlng, mapViewZoom);
      $('#headline').html('#'+top_p + ' <i>'+headline_h1+'</i>');
      $('#info').html('<p>'+info_p+'</p>');
    }

  </script>
</body>
</html>